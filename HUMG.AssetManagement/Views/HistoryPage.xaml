<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HUMG.AssetManagement.Views.HistoryPage"
             Title="Lá»‹ch sá»­ Thay Ä‘á»•i"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="Auto,*">

        <!-- Header vá»›i bá»™ lá»c -->
        <VerticalStackLayout Grid.Row="0" Padding="15" Spacing="10" BackgroundColor="White">

            <!-- Thá»‘ng kÃª -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                <Border Grid.Column="0"
                        BackgroundColor="#E3F2FD"
                        StrokeThickness="0"
                        Padding="10"
                        StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="3">
                        <Label x:Name="TotalHistoryLabel"
                               Text="0"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#0066CC"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="Tá»•ng sá»‘"
                               FontSize="11"
                               TextColor="#666"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="1"
                        BackgroundColor="#E8F5E9"
                        StrokeThickness="0"
                        Padding="10"
                        StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="3">
                        <Label x:Name="TodayHistoryLabel"
                               Text="0"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#4CAF50"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="HÃ´m nay"
                               FontSize="11"
                               TextColor="#666"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border Grid.Column="2"
                        BackgroundColor="#FFF3E0"
                        StrokeThickness="0"
                        Padding="10"
                        StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="3">
                        <Label x:Name="ThisWeekHistoryLabel"
                               Text="0"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#FF9800"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="Tuáº§n nÃ y"
                               FontSize="11"
                               TextColor="#666"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Bá»™ lá»c theo hÃ nh Ä‘á»™ng -->
            <Label Text="Lá»c theo hÃ nh Ä‘á»™ng:"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#333"
                   Margin="0,10,0,5"/>

            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                <Button Grid.Column="0"
                        x:Name="AllActionBtn"
                        Text="Táº¥t cáº£"
                        BackgroundColor="#0066CC"
                        TextColor="White"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterActionClicked"/>
                <Button Grid.Column="1"
                        x:Name="AddActionBtn"
                        Text="ThÃªm má»›i"
                        BackgroundColor="#E8F5E9"
                        TextColor="#4CAF50"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterActionClicked"/>
                <Button Grid.Column="2"
                        x:Name="EditActionBtn"
                        Text="Sá»­a"
                        BackgroundColor="#E3F2FD"
                        TextColor="#2196F3"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterActionClicked"/>
                <Button Grid.Column="3"
                        x:Name="DeleteActionBtn"
                        Text="XÃ³a"
                        BackgroundColor="#FFEBEE"
                        TextColor="#F44336"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterActionClicked"/>
            </Grid>

            <!-- Bá»™ lá»c theo thá»i gian -->
            <Label Text="Lá»c theo thá»i gian:"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#333"
                   Margin="0,10,0,5"/>

            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8">
                <Button Grid.Column="0"
                        x:Name="AllTimeBtn"
                        Text="Táº¥t cáº£"
                        BackgroundColor="#0066CC"
                        TextColor="White"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterTimeClicked"/>
                <Button Grid.Column="1"
                        x:Name="TodayBtn"
                        Text="HÃ´m nay"
                        BackgroundColor="#F5F5F5"
                        TextColor="#666"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterTimeClicked"/>
                <Button Grid.Column="2"
                        x:Name="WeekBtn"
                        Text="Tuáº§n nÃ y"
                        BackgroundColor="#F5F5F5"
                        TextColor="#666"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterTimeClicked"/>
                <Button Grid.Column="3"
                        x:Name="MonthBtn"
                        Text="ThÃ¡ng nÃ y"
                        BackgroundColor="#F5F5F5"
                        TextColor="#666"
                        FontSize="12"
                        CornerRadius="8"
                        Padding="5"
                        Clicked="OnFilterTimeClicked"/>
            </Grid>

        </VerticalStackLayout>

        <!-- Danh sÃ¡ch lá»‹ch sá»­ vá»›i RefreshView -->
        <RefreshView Grid.Row="1" 
                     x:Name="RefreshViewControl"
                     Refreshing="OnRefreshing">

            <CollectionView x:Name="HistoryCollectionView"
                            ItemsSource="{Binding FilteredHistories}"
                            SelectionMode="None">

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                       HorizontalOptions="Center"
                                       Padding="40">
                        <Label Text="ðŸ“…" FontSize="64" HorizontalTextAlignment="Center"/>
                        <Label Text="ChÆ°a cÃ³ lá»‹ch sá»­ nÃ o"
                               FontSize="18"
                               TextColor="#999999"
                               HorizontalTextAlignment="Center"
                               Margin="0,20,0,0"/>
                        <Label Text="CÃ¡c thay Ä‘á»•i sáº½ Ä‘Æ°á»£c ghi láº¡i táº¡i Ä‘Ã¢y"
                               FontSize="14"
                               TextColor="#CCCCCC"
                               HorizontalTextAlignment="Center"
                               Margin="0,10,0,0"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="15,8,15,8"
                                Padding="0"
                                BackgroundColor="White"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 12">

                            <Grid Padding="15" ColumnDefinitions="Auto,*" ColumnSpacing="15">

                                <!-- Icon hÃ nh Ä‘á»™ng -->
                                <Border Grid.Column="0"
                                        HeightRequest="60"
                                        WidthRequest="60"
                                        BackgroundColor="{Binding ActionColor}"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 10"
                                        VerticalOptions="Start">
                                    <Label Text="{Binding ActionIcon}"
                                           FontSize="32"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Border>

                                <!-- ThÃ´ng tin lá»‹ch sá»­ -->
                                <VerticalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Start">

                                    <!-- TiÃªu Ä‘á» hÃ nh Ä‘á»™ng -->
                                    <Label Text="{Binding ActionTitle}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#333333"
                                           LineBreakMode="WordWrap"/>

                                    <!-- MÃ´ táº£ -->
                                    <Label Text="{Binding Description}"
                                           FontSize="14"
                                           TextColor="#666666"
                                           LineBreakMode="WordWrap"/>

                                    <!-- ThÃ´ng tin thá»i gian vÃ  ngÆ°á»i thá»±c hiá»‡n -->
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10" Margin="0,5,0,0">
                                        <Border Grid.Column="0"
                                                Padding="6,3"
                                                BackgroundColor="#F5F5F5"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 4">
                                            <Label Text="{Binding ActionDate, StringFormat='ðŸ• {0:dd/MM/yyyy HH:mm}'}"
                                                   FontSize="12"
                                                   TextColor="#999999"/>
                                        </Border>
                                        <Border Grid.Column="1"
                                                Padding="6,3"
                                                BackgroundColor="#F5F5F5"
                                                StrokeThickness="0"
                                                StrokeShape="RoundRectangle 4">
                                            <Label Text="{Binding ActionByName, StringFormat='ðŸ‘¤ {0}'}"
                                                   FontSize="12"
                                                   TextColor="#999999"/>
                                        </Border>
                                    </Grid>

                                    <!-- NÃºt xem chi tiáº¿t tÃ i sáº£n (náº¿u cÃ³) -->
                                    <Button Text="Xem chi tiáº¿t tÃ i sáº£n â†’"
                                            BackgroundColor="Transparent"
                                            TextColor="#0066CC"
                                            FontSize="13"
                                            HorizontalOptions="Start"
                                            Padding="0"
                                            Margin="0,5,0,0"
                                            IsVisible="{Binding HasAsset}"
                                            Clicked="OnViewAssetClicked"
                                            CommandParameter="{Binding AssetId}"/>

                                </VerticalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </RefreshView>

    </Grid>

</ContentPage>